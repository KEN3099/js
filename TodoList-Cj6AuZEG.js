import{u as Z}from"./vue-i18n-DLYs8-Ps.js";import{a as C}from"./axios-NIGUFBhG.js";import{d as V}from"./dayjs-CflfeGVC.js";import{_ as ee}from"./index-CeZUq1ge.js";import{F as te,n as ae,I as oe,w as Te,a as se,S as le,x as ye,R as we,D as ne,g as ie,h as _,d as xe,f as De,C as Ye,B as Ce,j as Me,T as Ie,o as ke,s as Se}from"./ant-design-vue-A2bDz-ar.js";import{r as f,a as A,m as Ue,a9 as O,o as Y,aa as o,c as e,u as a,N as m,ad as u,q as Ne,l as He,z as Le,e as z,b as $,ab as X}from"./@vue-C4NowhOt.js";import"./@intlify-ZcBRI--x.js";import"./pinia-9OtbBE5K.js";import"./vue-router-PaDTG1U4.js";import"./@ant-design-BGOLSkC9.js";import"./@ctrl-DOFZgDuz.js";import"./element-plus-Mh0yyZIL.js";import"./lodash-es-wgX17T5E.js";import"./@vueuse-BBvwCcyR.js";import"./@element-plus-DaL4F972.js";import"./@popperjs-DB1lLFnh.js";import"./async-validator-CRx4dHSJ.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DnZj_KkR.js";import"./@babel-Bq4_u9L9.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-99Xd1yP8.js";import"./dom-align-CRCehRfe.js";import"./throttle-debounce-CUWDS_la.js";const ze={__name:"TodoFormModal",props:{visible:{type:Boolean,required:!0},todoData:{type:Object,default:()=>({})}},emits:["update:visible","success"],setup(R,{emit:i}){const{t:s}=Z(),q=R,S=i,x=f(),v=f(!1),n=A({id:void 0,title:"",detail:"",isTop:0,receiverType:0,status:0,startTime:null,endTime:null}),F={title:[{required:!0,message:s("todo.taskName"),trigger:"blur"}],status:[{required:!0,message:s("todo.status"),trigger:"change"}]},D="/api/host/";C.defaults.baseURL=D,Ue(()=>q.todoData,c=>{c&&Object.keys(c).length>0?Object.keys(n).forEach(l=>{l==="startTime"&&c[l]?n[l]=V(c[l]):l==="endTime"&&c[l]?n[l]=V(c[l]):n[l]=c[l]}):Object.keys(n).forEach(l=>{l==="status"||l==="isTop"||l==="receiverType"?n[l]=0:l==="startTime"||l==="endTime"?n[l]=null:n[l]=""})},{immediate:!0});const U=async()=>{try{await x.value.validateFields(),v.value=!0;const c={...n};c.startTime&&(c.startTime=c.startTime.format("YYYY-MM-DD")),c.endTime&&(c.endTime=c.endTime.format("YYYY-MM-DD"));const l=await C.post("/admin/todo/saveOrUpdate",c);l.data.code==200?(_.success(n.id?s("success.updateSuccess"):s("success.createSuccess")),S("success"),y()):_.error(l.data.message||s("error.unknownError"))}catch(c){console.error("保存失败:",c),_.error(c.message||s("error.unknownError"))}finally{v.value=!1}},y=()=>{S("update:visible",!1),x.value?.resetFields()};return(c,l)=>{const b=oe,g=ae,N=Te,M=le,B=se,I=we,h=ye,H=ne,E=te,j=ie;return Y(),O(j,{title:n.id?a(s)("common.edit")+" "+a(s)("todo.title"):a(s)("common.add")+" "+a(s)("todo.title"),visible:R.visible,"confirm-loading":v.value,onOk:U,onCancel:y,width:"600px"},{default:o(()=>[e(E,{ref_key:"formRef",ref:x,model:n,rules:F,layout:"vertical"},{default:o(()=>[e(g,{label:a(s)("todo.taskName"),name:"title"},{default:o(()=>[e(b,{value:n.title,"onUpdate:value":l[0]||(l[0]=p=>n.title=p),placeholder:a(s)("common.select")+" "+a(s)("todo.taskName")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(g,{label:a(s)("todo.description")||"详情",name:"detail"},{default:o(()=>[e(N,{value:n.detail,"onUpdate:value":l[1]||(l[1]=p=>n.detail=p),placeholder:a(s)("common.select"),rows:4},null,8,["value","placeholder"])]),_:1},8,["label"]),e(g,{label:a(s)("todo.status"),name:"status"},{default:o(()=>[e(B,{value:n.status,"onUpdate:value":l[2]||(l[2]=p=>n.status=p),placeholder:a(s)("common.select")},{default:o(()=>[e(M,{value:0},{default:o(()=>[m(u(a(s)("todo.statusPending")),1)]),_:1}),e(M,{value:1},{default:o(()=>[m(u(a(s)("todo.statusInProgress")),1)]),_:1}),e(M,{value:2},{default:o(()=>[m(u(a(s)("todo.statusCompleted")),1)]),_:1}),e(M,{value:3},{default:o(()=>[m(u(a(s)("todo.statusCancelled")),1)]),_:1})]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),e(g,{label:"是否置顶",name:"isTop"},{default:o(()=>[e(h,{value:n.isTop,"onUpdate:value":l[3]||(l[3]=p=>n.isTop=p)},{default:o(()=>[e(I,{value:0},{default:o(()=>[m(u(a(s)("common.no")),1)]),_:1}),e(I,{value:1},{default:o(()=>[m(u(a(s)("common.yes")),1)]),_:1})]),_:1},8,["value"])]),_:1}),e(g,{label:"通知范围",name:"receiverType"},{default:o(()=>[e(h,{value:n.receiverType,"onUpdate:value":l[4]||(l[4]=p=>n.receiverType=p)},{default:o(()=>[e(I,{value:0},{default:o(()=>[m("指定")]),_:1}),e(I,{value:1},{default:o(()=>[m("全部")]),_:1})]),_:1},8,["value"])]),_:1}),e(g,{label:a(s)("time.startDate"),name:"startTime"},{default:o(()=>[e(H,{value:n.startTime,"onUpdate:value":l[5]||(l[5]=p=>n.startTime=p),"show-time":"",format:"YYYY-MM-DD",placeholder:a(s)("common.select"),style:{width:"100%"}},null,8,["value","placeholder"])]),_:1},8,["label"]),e(g,{label:a(s)("time.endDate"),name:"endTime"},{default:o(()=>[e(H,{value:n.endTime,"onUpdate:value":l[6]||(l[6]=p=>n.endTime=p),"show-time":"",format:"YYYY-MM-DD",placeholder:a(s)("common.select"),style:{width:"100%"}},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title","visible","confirm-loading"])}}},Oe=ee(ze,[["__scopeId","data-v-17694c19"]]),Re={class:"form-fields"},qe={class:"form-actions"},Fe=["onClick"],Be={class:"action-link"},Ee=["onClick"],je={key:2,class:"title-cell"},Pe={key:3,class:"detail-cell"},$e={__name:"TodoList",setup(R){const{t:i}=Z(),s=A({title:null,status:void 0,startTime:null,endTime:null}),q="/api/host/";C.defaults.baseURL=q;const S=f([]),x=f(!1),v=f(!1),n=A({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]}),F=Ne(()=>[{title:"ID",dataIndex:"id",width:50},{title:i("todo.taskName"),dataIndex:"title",width:200},{title:i("todo.description"),dataIndex:"detail",width:300},{title:"置顶",dataIndex:"isTop",width:100,customRender:({text:t})=>t===1?"是":"否"},{title:"通知范围",dataIndex:"receiverType",width:120,customRender:({text:t})=>t===1?"全部":"指定"},{title:i("todo.status"),dataIndex:"status",width:10},{title:i("time.startDate"),dataIndex:"startTime",width:180},{title:i("time.endDate"),dataIndex:"endTime",width:180},{title:i("fields.createdAt"),dataIndex:"gentime",width:180},{title:i("fields.action"),dataIndex:"action",width:180,fixed:v.value?void 0:"right"}]),D=f(!1),U=f({}),y=f(!1),c=f(!1),l=f({}),b=f([]),g=f([]),N=()=>{v.value=window.innerWidth<=768},M=(d,t)=>t.label.toLowerCase().indexOf(d.toLowerCase())>=0,B=d=>({0:"待办",1:"进行中",2:"已完成",3:"已取消"})[d]||"未知",I=d=>({0:"default",1:"processing",2:"success",3:"error"})[d]||"default",h=async()=>{try{x.value=!0;const d={page:n.current,size:n.pageSize,...s};d.startTime&&(d.startTime=d.startTime.format("YYYY-MM-DD HH:mm:ss")),d.endTime&&(d.endTime=d.endTime.format("YYYY-MM-DD HH:mm:ss"));const t=await C.post("/admin/todo/query",d);t.data.code==200?(S.value=t.data.data.records||t.data.data||[],n.total=t.data.data.total||0):_.error(t.data.message||"查询失败")}catch(d){console.error("查询失败:",d),_.error("查询失败: "+d.message)}finally{x.value=!1}},H=()=>{n.current=1,h()},E=()=>{s.title=null,s.status=void 0,s.startTime=null,s.endTime=null,n.current=1,h()},j=d=>{n.current=d.current,n.pageSize=d.pageSize,h()},p=()=>{U.value={},D.value=!0},de=d=>{U.value={...d},D.value=!0},re=async d=>{l.value=d,y.value=!0,b.value=[];try{const t=await C.get(`/admin/host/query?id=${d.id}&type=1`);if(t.data.code===200){const k=t.data.data.hostList||t.data.data||[];g.value=k.map(T=>({label:T.hostName,value:T.id})),t.data.data.selectedHostIds&&(b.value=t.data.data.selectedHostIds)}else _.error("获取房东列表失败")}catch(t){console.error("获取房东列表失败:",t),_.error("获取房东列表失败: "+t.message)}},ce=async()=>{if(!b.value||b.value.length===0){_.warning("请至少选择一个房东");return}c.value=!0;try{const d={id:l.value.id,hostIds:b.value},t=await C.post("/admin/host/saveOrUpdateHostTodo",d);t.data.code===200?(_.success("关联房东成功"),y.value=!1):_.error(t.data.message||"关联房东失败")}catch(d){console.error("关联房东失败:",d),_.error("关联房东失败: "+d.message)}finally{c.value=!1}},ue=async d=>{try{const t=new FormData;t.append("id",d.id);const k=await C.post("/admin/todo/delete",t);k.data.code==200?(_.success("删除成功"),await h()):_.error(k.data.message||"删除失败")}catch(t){console.error("删除失败:",t),_.error("删除失败: "+t.message)}},me=()=>{D.value=!1,h()};return He(()=>{N(),h(),window.addEventListener("resize",N)}),Le(()=>{window.removeEventListener("resize",N)}),(d,t)=>{const k=oe,T=ae,L=le,K=se,Q=ne,P=Ce,W=te,G=Ye,pe=Ie,_e=Se,fe=ke,ve=Me,ge=De,be=ie,he=xe;return Y(),O(he,{class:"todo-query-page"},{default:o(()=>[e(ge,{class:"content"},{default:o(()=>[e(G,{class:"query-card"},{default:o(()=>[e(W,{model:s,layout:"inline",class:"query-form"},{default:o(()=>[z("div",Re,[e(T,{label:a(i)("todo.taskName"),class:"form-item"},{default:o(()=>[e(k,{value:s.title,"onUpdate:value":t[0]||(t[0]=r=>s.title=r),placeholder:a(i)("common.search")+" "+a(i)("todo.taskName"),class:"responsive-input"},null,8,["value","placeholder"])]),_:1},8,["label"]),e(T,{label:a(i)("todo.status"),class:"form-item"},{default:o(()=>[e(K,{value:s.status,"onUpdate:value":t[1]||(t[1]=r=>s.status=r),style:{width:"150px"},placeholder:a(i)("common.select"),class:"responsive-select","get-popup-container":r=>r.parentNode},{default:o(()=>[e(L,{value:0},{default:o(()=>[m(u(a(i)("todo.statusPending")),1)]),_:1}),e(L,{value:1},{default:o(()=>[m(u(a(i)("todo.statusInProgress")),1)]),_:1}),e(L,{value:2},{default:o(()=>[m(u(a(i)("todo.statusCompleted")),1)]),_:1}),e(L,{value:3},{default:o(()=>[m(u(a(i)("todo.statusCancelled")),1)]),_:1})]),_:1},8,["value","placeholder","get-popup-container"])]),_:1},8,["label"]),e(T,{label:a(i)("time.startDate"),class:"form-item"},{default:o(()=>[e(Q,{value:s.startTime,"onUpdate:value":t[2]||(t[2]=r=>s.startTime=r),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:a(i)("common.select"),class:"responsive-date-picker","get-popup-container":r=>r.parentNode},null,8,["value","placeholder","get-popup-container"])]),_:1},8,["label"]),e(T,{label:a(i)("time.endDate"),class:"form-item"},{default:o(()=>[e(Q,{value:s.endTime,"onUpdate:value":t[3]||(t[3]=r=>s.endTime=r),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:a(i)("common.select"),class:"responsive-date-picker","get-popup-container":r=>r.parentNode},null,8,["value","placeholder","get-popup-container"])]),_:1},8,["label"])]),z("div",qe,[e(T,{class:"action-buttons"},{default:o(()=>[e(P,{type:"primary",onClick:H,class:"action-button"},{default:o(()=>[m(u(a(i)("common.search")),1)]),_:1}),e(P,{style:{"margin-left":"8px"},onClick:E,class:"action-button"},{default:o(()=>[m(u(a(i)("common.reset")),1)]),_:1}),e(P,{type:"primary",style:{"margin-left":"8px"},onClick:p,class:"action-button"},{default:o(()=>[m(u(a(i)("common.add")),1)]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1}),e(G,{class:"table-card",bodyStyle:{padding:0}},{default:o(()=>[e(ve,{dataSource:S.value,columns:F.value,loading:x.value,onChange:j,rowKey:"id",scroll:v.value?{x:1200}:void 0,size:v.value?"small":"default",pagination:v.value?{...n,simple:!0}:n},{bodyCell:o(({column:r,record:w})=>[r.dataIndex==="status"?(Y(),O(pe,{key:0,color:I(w.status)},{default:o(()=>[m(u(B(w.status)),1)]),_:2},1032,["color"])):r.dataIndex==="action"?(Y(),O(fe,{key:1,size:v.value?"small":"middle",class:"action-space"},{default:o(()=>[z("a",{onClick:J=>de(w),class:"action-link"},u(a(i)("common.edit")),9,Fe),e(_e,{title:a(i)("common.confirm"),onConfirm:J=>ue(w),"ok-text":a(i)("common.ok"),"cancel-text":a(i)("common.cancel")},{default:o(()=>[z("a",Be,u(a(i)("common.delete")),1)]),_:2},1032,["title","onConfirm","ok-text","cancel-text"]),w.receiverType!==1?(Y(),$("a",{key:0,onClick:J=>re(w),class:"action-link"},u(a(i)("fields.host")),9,Ee)):X("",!0)]),_:2},1032,["size"])):r.dataIndex==="title"?(Y(),$("div",je,u(w.title),1)):r.dataIndex==="detail"?(Y(),$("div",Pe,u(w.detail),1)):X("",!0)]),_:1},8,["dataSource","columns","loading","scroll","size","pagination"])]),_:1})]),_:1}),e(Oe,{visible:D.value,"onUpdate:visible":t[4]||(t[4]=r=>D.value=r),"todo-data":U.value,onSuccess:me},null,8,["visible","todo-data"]),e(be,{visible:y.value,"onUpdate:visible":t[6]||(t[6]=r=>y.value=r),title:a(i)("fields.host"),onOk:ce,onCancel:t[7]||(t[7]=r=>y.value=!1),"confirm-loading":c.value,width:v.value?"95%":"520px"},{default:o(()=>[e(W,{layout:"vertical"},{default:o(()=>[e(T,{label:a(i)("fields.host")},{default:o(()=>[e(K,{value:b.value,"onUpdate:value":t[5]||(t[5]=r=>b.value=r),mode:"multiple",placeholder:a(i)("common.select"),options:g.value,optionFilterProp:"label",filterOption:M,"get-popup-container":r=>r.parentNode},null,8,["value","placeholder","options","get-popup-container"])]),_:1},8,["label"])]),_:1})]),_:1},8,["visible","title","confirm-loading","width"])]),_:1})}}},Tt=ee($e,[["__scopeId","data-v-a7c5b8c5"]]);export{Tt as default};
