import{a as C,r as M,l as E,b,c as a,aa as n,o as f,K,u as d,N as m,ad as _,e as P,a9 as A,ab as G,F as I}from"./@vue-C4NowhOt.js";import{u as J}from"./vue-i18n-DLYs8-Ps.js";import{a as F}from"./axios-NIGUFBhG.js";import{d as k}from"./dayjs-CflfeGVC.js";import{_ as Q}from"./index-CeZUq1ge.js";import{C as R,h as u,F as W,i as X,l as Z,n as $,D as tt,B as et,j as at,T as ot}from"./ant-design-vue-A2bDz-ar.js";import"./@intlify-ZcBRI--x.js";import"./pinia-9OtbBE5K.js";import"./vue-router-PaDTG1U4.js";import"./@ant-design-BGOLSkC9.js";import"./@ctrl-DOFZgDuz.js";import"./element-plus-Mh0yyZIL.js";import"./lodash-es-wgX17T5E.js";import"./@vueuse-BBvwCcyR.js";import"./@element-plus-DaL4F972.js";import"./@popperjs-DB1lLFnh.js";import"./async-validator-CRx4dHSJ.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DnZj_KkR.js";import"./@babel-Bq4_u9L9.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-99Xd1yP8.js";import"./dom-align-CRCehRfe.js";import"./throttle-debounce-CUWDS_la.js";const nt={class:"order-sync-container"},st={class:"sync-controls"},rt={__name:"OrderSync",setup(lt){const{t}=J(),l=C({startDate:null,endDate:null}),Y=M([]),g=M(!1),c=M(null),r=C({current:1,pageSize:20,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]}),z=[{title:t("fields.period"),dataIndex:"period",key:"period"},{title:t("fields.status"),dataIndex:"status",key:"status"},{title:t("settlement.generateTime"),dataIndex:"gentime",key:"gentime"},{title:t("settlement.updateTime"),dataIndex:"uptime",key:"uptime"}],O=e=>e&&e>=k().startOf("month"),B=e=>({0:t("status.pending"),1:t("status.success"),2:t("status.failed")})[e]||t("status.unknown"),T=e=>({0:"orange",1:"green",2:"red"})[e]||"default",N=e=>e?k(e).format("YYYY-MM-DD HH:mm:ss"):"",p=async()=>{try{g.value=!0;const e={current:r.current,size:r.pageSize,startDate:l.startDate,endDate:l.endDate},o=await F.get("/admin/setting/syncOrderList",{params:e});o.data.code===200?(Y.value=o.data.data.records,r.total=o.data.data.total,r.current=o.data.data.current,r.pageSize=o.data.data.size):u.error(o.data.message||t("common.queryFailed"))}catch(e){u.error(t("common.queryFailed")+": "+e.message)}finally{g.value=!1}},x=()=>{r.current=1,p()},q=()=>{l.startDate=null,l.endDate=null,r.current=1,p()},V=e=>{r.current=e.current,r.pageSize=e.pageSize,p()},U=async()=>{if(!c.value){u.warning(t("common.select"));return}const e=new FormData,o=k(c.value).format("YYYY-MM");e.append("yearMonth",o);try{const i=await F.post("/admin/setting/syncLastMonthOrder",e);i.data.code===200?(u.success(t("success.operationSuccess")),await p(),c.value=null):u.error(i.data.message||t("common.queryFailed"))}catch(i){u.error(t("common.queryFailed")+": "+i.message)}};return E(()=>{p()}),(e,o)=>{const i=tt,y=$,D=Z,v=et,S=X,j=W,w=R,H=ot,L=at;return f(),b("div",nt,[a(w,null,{default:n(()=>[a(j,{model:l,"label-col":{span:6},"wrapper-col":{span:18},onSubmit:K(x,["prevent"])},{default:n(()=>[a(S,{gutter:24},{default:n(()=>[a(D,{span:8},{default:n(()=>[a(y,{label:d(t)("time.startDate")},{default:n(()=>[a(i,{value:l.startDate,"onUpdate:value":o[0]||(o[0]=s=>l.startDate=s),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1}),a(D,{span:8},{default:n(()=>[a(y,{label:d(t)("time.endDate")},{default:n(()=>[a(i,{value:l.endDate,"onUpdate:value":o[1]||(o[1]=s=>l.endDate=s),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1}),a(D,{span:8},{default:n(()=>[a(y,{"wrapper-col":{span:24}},{default:n(()=>[a(v,{type:"primary",onClick:x},{default:n(()=>[m(_(d(t)("common.search")),1)]),_:1}),a(v,{style:{"margin-left":"8px"},onClick:q},{default:n(()=>[m(_(d(t)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(S,null,{default:n(()=>[P("div",st,[a(i,{value:c.value,"onUpdate:value":o[2]||(o[2]=s=>c.value=s),picker:"month","disabled-date":O,class:"sync-date-picker",placeholder:d(t)("time.selectMonthYear")},null,8,["value","placeholder"]),a(v,{type:"primary",disabled:!c.value,onClick:U,class:"sync-button"},{default:n(()=>[m(_(d(t)("order.syncOrders")),1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["model"])]),_:1}),a(w,{style:{"margin-top":"16px"}},{default:n(()=>[a(L,{columns:z,"data-source":Y.value,pagination:r,loading:g.value,onChange:V,"row-key":"id"},{bodyCell:n(({column:s,record:h})=>[s.dataIndex==="period"?(f(),b(I,{key:0},[],64)):s.dataIndex==="status"?(f(),A(H,{key:1,color:T(h.status)},{default:n(()=>[m(_(B(h.status)),1)]),_:2},1032,["color"])):s.dataIndex==="gentime"||s.dataIndex==="uptime"?(f(),b(I,{key:2},[m(_(N(h[s.dataIndex])),1)],64)):G("",!0)]),_:1},8,["data-source","pagination","loading"])]),_:1})])}}},Vt=Q(rt,[["__scopeId","data-v-1b5cf08a"]]);export{Vt as default};
