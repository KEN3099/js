import{u as K}from"./vue-i18n-DLYs8-Ps.js";import{M as X}from"./@element-plus-DaL4F972.js";import{a as N}from"./axios-NIGUFBhG.js";import{_ as Z,r as B}from"./index-CeZUq1ge.js";import{B as ee}from"./ant-design-vue-A2bDz-ar.js";import{E as te,a as ae,b as oe,c as ne,d as re}from"./element-plus-Mh0yyZIL.js";import{r as v,q as E,l as se,b as D,c as w,e as s,aa as y,ad as r,u as p,F as T,o as h,N as L,ab as k,ag as le,a9 as ie,a5 as ce}from"./@vue-C4NowhOt.js";import"./@intlify-ZcBRI--x.js";import"./pinia-9OtbBE5K.js";import"./vue-router-PaDTG1U4.js";import"./@ant-design-BGOLSkC9.js";import"./@ctrl-DOFZgDuz.js";import"./@babel-Bq4_u9L9.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-99Xd1yP8.js";import"./dom-align-CRCehRfe.js";import"./lodash-es-wgX17T5E.js";import"./dayjs-CflfeGVC.js";import"./async-validator-CRx4dHSJ.js";import"./throttle-debounce-CUWDS_la.js";import"./@vueuse-BBvwCcyR.js";import"./@popperjs-DB1lLFnh.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DnZj_KkR.js";const ue={class:"room-gantt-container"},de={class:"gantt-panel"},me={class:"gantt-header"},pe={class:"room-search-header"},he={key:0,class:"category-header"},fe={class:"category-name"},_e={key:1,class:"room-basic-info"},ge={class:"room-image"},ve=["src","alt"],De={class:"room-info"},we={class:"room-name"},ye={class:"room-details"},be={key:0},ke={key:1},Ce=["onClick"],Se={key:0,class:"booking-info"},Me={class:"order-id"},xe={class:"platform"},Ie={key:0,class:"stay-days"},Ye={__name:"OrderGantt",setup($e){const{t:f}=K(),I=new Date,c=v(I.getFullYear()),u=v(I.getMonth()+1),O=E(()=>new Date(c.value,u.value,0).getDate()),P="/api/host/";N.defaults.baseURL=P;const Y=v(`${c.value}-${String(u.value).padStart(2,"0")}`),b=v("");v(null);const C=v(!1),S=v([]),$=v([]),F=e=>`https://funkey-public.oss-cn-shenzhen.aliyuncs.com/resource/${e}`,U=E(()=>b.value?S.value.filter(e=>e.name&&e.name.toLowerCase().includes(b.value.toLowerCase())||e.physicalRoomId&&e.physicalRoomId.toLowerCase().includes(b.value.toLowerCase())):S.value),_=(e,a)=>{if(e.isCategory)return null;const o=`${c.value}-${String(u.value).padStart(2,"0")}-${String(a).padStart(2,"0")}`;return $.value.find(l=>l.actualPhysicalRoomId===e.id&&new Date(l.checkin)<=new Date(o)&&new Date(l.checkout)>new Date(o))||null},q=(e,a)=>{const o=_(e,a);if(!o)return null;const n=new Date(o.checkin);return n.getDate()===a&&n.getMonth()+1===u.value?a:null},z=(e,a)=>{if(e.isCategory)return"";const o=_(e,a);if(!o)return"empty";const n=new Date(o.checkin),l=new Date(o.checkout),i=new Date(c.value,u.value-1,a);return i.toDateString()===n.toDateString()?"booking-start":i.toDateString()===new Date(l-1440*60*1e3).toDateString()?"booking-end":i>n&&i<l?"booking-middle":"empty"},G=(e,a)=>{if(e.isCategory)return;_(e,a)&&B.push({path:"/orderCal",query:{roomId:e.id,pid:e.physicalRoomId,year:c.value,month:u.value}})},j=({row:e,column:a,rowIndex:o,columnIndex:n})=>{if(!e)return[1,1];if(e.isCategory)return n===0?[1,1]:[0,0];if(n===0)return;const l=parseInt(a.label),i=new Date(c.value,u.value-1,l),g=_(e,l);if(!g)return[1,1];const m=new Date(g.checkin),t=new Date(g.checkout),d=new Date(c.value,u.value-1,1),M=new Date(c.value,u.value,0),x=m>=d?m:d,R=t<=M?new Date(t-1440*60*1e3):M;if(i.toDateString()===x.toDateString()){const J=R.getTime()-x.getTime();return[1,Math.ceil(J/(1e3*60*60*24))+1]}return i>x&&i<=R?[0,0]:[1,1]},H=e=>{if(e){const[a,o]=e.split("-").map(Number);c.value=a,u.value=o,V()}},Q=async()=>{C.value=!0;try{const a=`/host/order/query2cal?year=${c.value}&month=${u.value}`,o=await N.get(a);if(!o.data||!o.data.data)return;var e=o.data.data;e.order&&($.value=e.order),e.room,S.value=Object.entries(e.room).flatMap(([n,l])=>{const i={id:`category-${n}`,name:n,isCategory:!0,uuid:"",bedNum:null,standardPrice:null},g=l.map((m,t)=>({...m,id:m.id||`${n}-${t+1}`,name:m.physicalRoomId||m.nearestStation||`房间${t+1}`,category:n}));return[i,...g]})}catch(a){console.error("获取房间数据失败:",a)}finally{C.value=!1}},W=()=>{B.push("/order")},V=async()=>{await Promise.all([Q()])};se(()=>{V()});const A=e=>{const a=new Date,o=new Date(a.getFullYear(),a.getMonth()-3,1),n=new Date(a.getFullYear(),a.getMonth()+3,1);return e<o||e>n};return(e,a)=>{const o=ee,n=te,l=re,i=ne,g=oe,m=ae;return h(),D(T,null,[w(o,{type:"primary",onClick:W},{default:y(()=>[L(r(p(f)("common.listView")),1)]),_:1}),w(o,{type:"primary",disabled:"true",style:{"margin-left":"10px"}},{default:y(()=>[L(r(p(f)("common.calendarView")),1)]),_:1}),s("div",ue,[s("div",de,[s("div",me,[s("h2",null,r(c.value)+r((p(f)("time.thisYear"),""))+r((p(f)("time.thisMonth"),"")),1),w(n,{modelValue:Y.value,"onUpdate:modelValue":a[0]||(a[0]=t=>Y.value=t),type:"month",placeholder:p(f)("fields.selectPeriodFrom"),format:"YYYY年MM月","value-format":"YYYY-MM","disabled-date":A,onChange:H,style:{width:"150px","margin-left":"20px"}},null,8,["modelValue","placeholder"])]),w(m,{data:U.value,border:"",height:"calc(100vh - 120px)","empty-text":"暂无房间数据",loading:C.value,ref:"ganttTableRef","span-method":j},{default:y(()=>[w(g,{fixed:"left",label:"房间信息",width:"200"},{header:y(()=>[s("div",pe,[w(i,{modelValue:b.value,"onUpdate:modelValue":a[1]||(a[1]=t=>b.value=t),placeholder:"搜索房间...",clearable:"",size:"small",style:{width:"100%"}},{prefix:y(()=>[w(l,null,{default:y(()=>[w(p(X))]),_:1})]),_:1},8,["modelValue"])])]),default:y(t=>[t.row.isCategory?(h(),D("div",he,[s("div",fe,r(t.row.name),1)])):(h(),D("div",_e,[s("div",ge,[s("img",{src:F(t.row.uuid),referrerpolicy:"no-referrer",alt:t.row.name},null,8,ve)]),s("div",De,[s("div",we,r(t.row.name),1),s("div",ye,[t.row.bedNum?(h(),D("span",be,r(p(f)("room.maxGuestNum"))+": "+r(t.row.bedNum)+r(p(f)("common.people")),1)):k("",!0),t.row.standardPrice?(h(),D("span",ke,r(p(f)("room.price"))+": "+r(t.row.standardPrice),1)):k("",!0)])])]))]),_:1}),(h(!0),D(T,null,le(O.value,t=>(h(),ie(g,{key:t,prop:"day"+t,label:t.toString(),align:"center",width:"60"},{default:y(d=>[s("div",{class:ce(["date-cell",z(d.row,t)]),onClick:M=>G(d.row,t)},[_(d.row,t)?(h(),D("div",Se,[s("div",Me,r(_(d.row,t).id),1),s("div",xe,r(_(d.row,t).platform),1),t===q(d.row,t)?(h(),D("div",Ie,r(_(d.row,t).lengthOfStay)+"晚 ",1)):k("",!0)])):k("",!0)],10,Ce)]),_:2},1032,["prop","label"]))),128))]),_:1},8,["data","loading"])])])],64)}}},lt=Z(Ye,[["__scopeId","data-v-eb1836f5"]]);export{lt as default};
