import{r as i,q as O,l as Z,b as f,c as o,aa as l,o as c,K as ee,u,e as ae,N as k,ad as _,ab as te,F as N,a9 as oe}from"./@vue-C4NowhOt.js";import{u as le}from"./vue-i18n-DLYs8-Ps.js";import{a as C}from"./axios-NIGUFBhG.js";import{d as ne}from"./dayjs-CflfeGVC.js";import{_ as se}from"./index-CeZUq1ge.js";import{C as re,h as p,F as de,i as ie,l as ue,n as ce,a as pe,D as me,B as ve,j as fe,I as _e}from"./ant-design-vue-A2bDz-ar.js";import"./@intlify-ZcBRI--x.js";import"./pinia-9OtbBE5K.js";import"./vue-router-PaDTG1U4.js";import"./@ant-design-BGOLSkC9.js";import"./@ctrl-DOFZgDuz.js";import"./element-plus-Mh0yyZIL.js";import"./lodash-es-wgX17T5E.js";import"./@vueuse-BBvwCcyR.js";import"./@element-plus-DaL4F972.js";import"./@popperjs-DB1lLFnh.js";import"./async-validator-CRx4dHSJ.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DnZj_KkR.js";import"./@babel-Bq4_u9L9.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-99Xd1yP8.js";import"./dom-align-CRCehRfe.js";import"./throttle-debounce-CUWDS_la.js";const ye={style:{display:"flex",gap:"8px"}},ge={key:1},he={key:2,style:{display:"flex",gap:"5px","flex-wrap":"nowrap"}},ke={key:0},xe={key:1},Ie={__name:"SettlementOrder",setup(De){const{t:a}=le(),g=i([]),w=i(!1),r=i(null),x=i(null),Y=i([]),F=i(!1),z=O(()=>[{label:a("common.all"),value:null},...Y.value]),L=i([]),S=i(!1),R=O(()=>[{label:a("common.all"),value:null},...L.value]),s=i({startDate:null,endDate:null,hostId:void 0,pid:void 0}),m=i({current:1,pageSize:10,total:0}),A=O(()=>[{title:"No.",dataIndex:"no",key:"no"},{title:"PID",dataIndex:"pid",key:"pid"},{title:a("fields.host"),dataIndex:"hostName",key:"hostName"},{title:a("order.platform"),dataIndex:"platform",key:"platform"},{title:a("order.reservationCode"),dataIndex:"reservationCode",key:"reservationCode"},{title:a("order.checkIn"),dataIndex:"checkin",key:"checkin"},{title:a("order.checkOut"),dataIndex:"checkout",key:"checkout"},{title:a("order.lengthOfStay"),dataIndex:"lengthOfStay",key:"lengthOfStay"},{title:a("order.guestName"),dataIndex:"guestName",key:"guestName"},{title:a("order.totalCost"),dataIndex:"totalCost",key:"totalCost"},{title:a("order.cleanFee"),dataIndex:"cleanFee",key:"cleanFee"},{title:a("order.currency"),dataIndex:"currency",key:"currency"},{title:a("fields.action"),dataIndex:"action",key:"action"}]),H=async()=>{try{F.value=!0;const e=await C.get("/admin/host/getAllHostName");e.data.code==200?Y.value=e.data.data.map(t=>({label:t.hostName,value:t.id})):p.error(e.data.message||a("common.getHostListFailed"))}catch(e){console.error("获取房东列表失败:",e),p.error(a("common.getHostListFailed")+": "+e.message)}finally{F.value=!1}},V=async()=>{try{S.value=!0;const e=await C.get("/admin/settlementReport/getPidList");e.data.code==200?L.value=e.data.data.map(t=>({label:t.pid,value:t.id})):p.error(e.data.message||a("common.getPidListFailed"))}catch(e){console.error("获取PID列表失败:",e),p.error(a("common.getPidListFailed")+": "+e.message)}finally{S.value=!1}},T=e=>({1:"Airbnb",2:"Booking.com"})[e]||e,j=e=>e?ne(e).format("YYYY-MM-DD"):"",M=(e,t)=>t.label.toLowerCase().indexOf(e.toLowerCase())>=0,b=async(e=1,t=10)=>{w.value=!0;try{const v={page:e,size:t,startDate:s.value.startDate,endDate:s.value.endDate,hostId:s.value.hostId,pid:s.value.pid},d=await C.get("/admin/setting/settlementOrderList",{params:v});d.data.code===200?(m.value.current=e,m.value.pageSize=t,m.value.total=d.data.data.total,g.value=d.data.data.records.map((y,I)=>({...y,key:(e-1)*t+I,no:(e-1)*t+I+1}))):p.error(d.data.message||a("common.queryFailed"))}catch(v){p.error(a("common.queryFailed")+": "+v.message)}finally{w.value=!1}},E=e=>{b(e.current,e.pageSize)},P=()=>{m.value.current=1,b(1,m.value.pageSize)},W=()=>{s.value.startDate=null,s.value.endDate=null,s.value.hostId=void 0,s.value.pid=void 0,m.value.current=1,b(1,m.value.pageSize)},K=e=>{r.value&&B(),x.value={...e},r.value={...e}},$=async()=>{if(r.value)try{const e=await C.post("/admin/setting/saveSettlementOrder",r.value);if(e.data.code===200){p.success(a("success.saveSuccess"));const t=g.value.findIndex(v=>v.id===r.value.id);t!==-1&&(g.value[t]={...r.value}),r.value=null,x.value=null}else p.error(e.data.message||a("common.queryFailed"))}catch(e){p.error(a("common.queryFailed")+": "+e.message)}},B=()=>{if(r.value&&x.value){const e=g.value.findIndex(t=>t.id===r.value.id);e!==-1&&(g.value[e]={...x.value})}r.value=null,x.value=null};return Z(()=>{H(),V(),b()}),(e,t)=>{const v=pe,d=ce,y=ue,I=me,D=ve,G=ie,J=de,U=re,Q=_e,X=fe;return c(),f("div",null,[o(U,{style:{"margin-bottom":"16px"}},{default:l(()=>[o(J,{model:s.value,"label-col":{span:6},"wrapper-col":{span:18},onSubmit:ee(P,["prevent"])},{default:l(()=>[o(G,{gutter:24},{default:l(()=>[o(y,{span:4},{default:l(()=>[o(d,{label:u(a)("fields.host")},{default:l(()=>[o(v,{value:s.value.hostId,"onUpdate:value":t[0]||(t[0]=n=>s.value.hostId=n),"show-search":"",placeholder:u(a)("common.select"),options:z.value,loading:F.value,"filter-option":M,"allow-clear":""},null,8,["value","placeholder","options","loading"])]),_:1},8,["label"])]),_:1}),o(y,{span:3},{default:l(()=>[o(d,{label:"PID"},{default:l(()=>[o(v,{value:s.value.pid,"onUpdate:value":t[1]||(t[1]=n=>s.value.pid=n),"show-search":"",placeholder:u(a)("common.select"),options:R.value,loading:S.value,"filter-option":M,"allow-clear":""},null,8,["value","placeholder","options","loading"])]),_:1})]),_:1}),o(y,{span:5},{default:l(()=>[o(d,{label:u(a)("time.startDate")},{default:l(()=>[o(I,{value:s.value.startDate,"onUpdate:value":t[2]||(t[2]=n=>s.value.startDate=n),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1}),o(y,{span:5},{default:l(()=>[o(d,{label:u(a)("time.endDate")},{default:l(()=>[o(I,{value:s.value.endDate,"onUpdate:value":t[3]||(t[3]=n=>s.value.endDate=n),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1}),o(y,{span:4},{default:l(()=>[o(d,{"wrapper-col":{span:24}},{default:l(()=>[ae("div",ye,[o(D,{type:"primary",onClick:P},{default:l(()=>[k(_(u(a)("common.search")),1)]),_:1}),o(D,{onClick:W},{default:l(()=>[k(_(u(a)("common.reset")),1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(U,null,{default:l(()=>[o(X,{columns:A.value,"data-source":g.value,loading:w.value,pagination:m.value,scroll:{x:!0},onChange:E,"row-key":"id"},{bodyCell:l(({column:n,record:h})=>[n.dataIndex==="checkin"||n.dataIndex==="checkout"?(c(),f(N,{key:0},[k(_(j(h[n.dataIndex])),1)],64)):n.dataIndex==="platform"?(c(),f("span",ge,_(T(h.platform)),1)):n.dataIndex==="action"?(c(),f("div",he,[r.value&&r.value.id===h.id?(c(),f(N,{key:0},[o(D,{type:"primary",size:"small",onClick:$},{default:l(()=>[k(_(u(a)("common.save")),1)]),_:1}),o(D,{size:"small",onClick:B},{default:l(()=>[k(_(u(a)("common.cancel")),1)]),_:1})],64)):(c(),oe(D,{key:1,type:"link",onClick:q=>K(h)},{default:l(()=>[k(_(u(a)("common.edit")),1)]),_:2},1032,["onClick"]))])):n.dataIndex==="cleanFee"||n.dataIndex==="totalCost"?(c(),f(N,{key:3},[r.value&&r.value.id===h.id?(c(),f("span",ke,[o(Q,{value:r.value[n.dataIndex],"onUpdate:value":q=>r.value[n.dataIndex]=q,style:{width:"100px"}},null,8,["value","onUpdate:value"])])):(c(),f("span",xe,_(h[n.dataIndex]),1))],64)):te("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),_:1})])}}},Ze=se(Ie,[["__scopeId","data-v-b3d191c4"]]);export{Ze as default};
