import{u as ue}from"./vue-i18n-DLYs8-Ps.js";import{a as F}from"./axios-NIGUFBhG.js";import{b as ce}from"./vue-router-PaDTG1U4.js";import{_ as ie,r as de}from"./index-CeZUq1ge.js";import{e as ve,f as me,g as pe,h as he,j as fe,k as _e}from"./element-plus-Mh0yyZIL.js";import{r as d,q as I,m as z,l as be,b as k,e as h,a9 as L,ab as M,c as o,aa as t,u as r,ad as a,F as Y,ax as ge,ay as ke,o as p,N as u,ag as ye}from"./@vue-C4NowhOt.js";import"./@intlify-ZcBRI--x.js";import"./pinia-9OtbBE5K.js";import"./ant-design-vue-A2bDz-ar.js";import"./@babel-Bq4_u9L9.js";import"./@ant-design-BGOLSkC9.js";import"./@ctrl-DOFZgDuz.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-99Xd1yP8.js";import"./dom-align-CRCehRfe.js";import"./lodash-es-wgX17T5E.js";import"./dayjs-CflfeGVC.js";import"./async-validator-CRx4dHSJ.js";import"./throttle-debounce-CUWDS_la.js";import"./@vueuse-BBvwCcyR.js";import"./@element-plus-DaL4F972.js";import"./@popperjs-DB1lLFnh.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DnZj_KkR.js";const we=D=>(ge("data-v-1f623b7a"),D=D(),ke(),D),Ce={class:"pg-header"},De={class:"header-title"},Ie={class:"calendar-container"},xe={class:"calendar-panel"},Ee={key:0,class:"details-panel"},Be={key:0,class:"booking-details"},Fe={key:1,class:"no-selection"},ze=we(()=>h("p",null,"请选择一个订单查看详细信息",-1)),Me=[ze],Se={style:{margin:"0","font-size":"18px"}},Oe={key:0,class:"booking-details"},Ve={__name:"OrderCal",setup(D){const{t:l,locale:U}=ue(),W="/api/host/";F.defaults.baseURL=W;const x=d([]),c=d(null),S=d(!1),f=d(!1),E=d(""),O=d([]),g=d(!1),V=d(null),s=d(null),y=ce();let R=y.query.roomId,A=y.query.year,T=y.query.month,B=new Date;A&&B.setFullYear(parseInt(A)),T&&B.setMonth(parseInt(T)-1);const w=d(B),_=I(()=>w.value.getFullYear()),b=I(()=>w.value.getMonth()+1),q=()=>{const e=new Date,n=new Date(e.getFullYear(),e.getMonth()-3,1),v=new Date(e.getFullYear(),e.getMonth()+3,1);return{minDate:n,maxDate:v}},G=I(()=>({initialView:"dayGridMonth",locale:j(),firstDay:0,headerToolbar:!1,events:N.value,eventContent:H,dateClick:Q,eventClick:X,initialDate:new Date(_.value,b.value-1,1)}));z(U,()=>{s.value&&s.value.setOption("locale",j())}),z(f,e=>{!g.value&&s.value&&setTimeout(()=>{s.value.updateSize()},100)});const j=()=>{switch(localStorage.getItem("language")||"en"){case"zh-CN":return"zh-cn";case"ja-JP":return"ja";case"zh-TW":return"zh-tw";default:return"en"}},N=I(()=>x.value.map(e=>({id:e.id,title:e.reservationCode,start:e.checkin,end:e.checkout,extendedProps:{booking:e}}))),H=e=>({html:` <div class="event-title" style=" height: 20px;background-color: ${K(e.event.extendedProps.booking.platform)}">${e.event.title}</div>`}),P=()=>{g.value=window.innerWidth<=768},C=async()=>{S.value=!0;try{const e=await F.get(`/host/order/getRoomOrder?pid=${R}&year=${_.value}&month=${b.value}`);x.value=e.data.data}catch(e){console.error("获取订单数据失败:",e)}finally{S.value=!1}},J=async()=>{try{const n=(await F.get("/host/room/queryByHostId")).data;O.value=n.data||[],y.query.roomId&&(E.value=parseInt(y.query.roomId))}catch(e){console.error("获取房间数据失败:",e)}},K=e=>({airbnb:"#FF5A5F",expedia:"#197FE0",agoda:"#003063",booking:"#077054",zizaike:"#FF9900",asiayo:"#FFD166",tujia:"#FF6B6B",zbj:"#6B5B95",onehome:"#88D498",xiaozhu:"#F39C12",homeaway:"#1E3A8A",offline:"#95A5A6",waka:"#3498DB",ctrip:"#34495E",feizhu:"#E74C3C",meituanminsu:"#1ABC9C",jalan:"#8E44AD"})[e]||"#32CD32",Q=e=>{f.value=!1},X=e=>{const n=e.event.extendedProps.booking;Z(n),!g.value&&s.value&&setTimeout(()=>{s.value.updateSize()},100)},Z=e=>{c.value=e,f.value=!0,!g.value&&s.value&&setTimeout(()=>{s.value.updateSize()},100)},ee=e=>{console.log("选中的房间ID:",e),R=e,C()},te=()=>{const{minDate:e}=q();new Date(_.value,b.value-1,1);const n=new Date(_.value,b.value-2,1);n<e||(s.value.prev(),w.value=n,C())},ae=()=>{const{maxDate:e}=q();new Date(_.value,b.value-1,1);const n=new Date(_.value,b.value,1);n>e||(s.value.next(),w.value=n,C())},oe=()=>{s.value.today();const e=s.value.getDate();w.value=e,C()},le=()=>{de.go(-1)};return z(x,e=>{s.value&&(s.value.removeAllEvents(),s.value.addEventSource(N.value))},{deep:!0}),be(async()=>{await J(),await C(),P(),window.addEventListener("resize",P),s.value=new window.FullCalendar.Calendar(V.value,G.value),s.value.render()}),(e,n)=>{const v=ve,ne=fe,re=me,i=_e,$=pe,se=he;return p(),k(Y,null,[h("div",Ce,[o(v,{onClick:le,class:"header-button"},{default:t(()=>[u(a(r(l)("common.back")),1)]),_:1}),o(re,{modelValue:E.value,"onUpdate:modelValue":n[0]||(n[0]=m=>E.value=m),placeholder:r(l)("room.selectRoom")||r(l)("common.select"),onChange:ee,class:"room-select",clearable:""},{default:t(()=>[(p(!0),k(Y,null,ye(O.value,m=>(p(),L(ne,{key:m.id,label:m.physicalRoomId,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),o(v,{onClick:te,class:"header-button"},{default:t(()=>[u(a(r(l)("common.prevMonth")),1)]),_:1}),h("h2",De,a(_.value)+"年"+a(b.value)+"月",1),o(v,{onClick:ae,class:"header-button"},{default:t(()=>[u(a(r(l)("common.nextMonth")),1)]),_:1}),o(v,{onClick:oe,class:"header-button"},{default:t(()=>[u(a(r(l)("time.today")),1)]),_:1})]),h("div",Ie,[h("div",xe,[h("div",{ref_key:"calendarEl",ref:V},null,512)]),f.value&&!g.value?(p(),k("div",Ee,[c.value?(p(),k("div",Be,[h("h3",null,a(r(l)("order.viewDetails")),1),o($,{column:1,border:"",size:"small"},{default:t(()=>[o(i,{label:r(l)("order.reservationCode")},{default:t(()=>[u(a(c.value.reservationCode),1)]),_:1},8,["label"]),o(i,{label:"PID"},{default:t(()=>[u(a(c.value.pid),1)]),_:1}),o(i,{label:r(l)("order.checkIn")},{default:t(()=>[u(a(c.value.checkin),1)]),_:1},8,["label"]),o(i,{label:r(l)("order.checkOut")},{default:t(()=>[u(a(c.value.checkout),1)]),_:1},8,["label"]),o(i,{label:r(l)("order.platform")},{default:t(()=>[u(a(c.value.platform),1)]),_:1},8,["label"]),o(i,{label:r(l)("order.lengthOfStay")},{default:t(()=>[u(a(c.value.lengthOfStay),1)]),_:1},8,["label"])]),_:1})])):(p(),k("div",Fe,Me))])):M("",!0)]),g.value?(p(),L(se,{key:0,modelValue:f.value,"onUpdate:modelValue":n[2]||(n[2]=m=>f.value=m),"show-close":!0,width:"90%",class:"mobile-details-dialog"},{header:t(()=>[h("h3",Se,a(r(l)("order.viewDetails")),1)]),footer:t(()=>[o(v,{onClick:n[1]||(n[1]=m=>f.value=!1)},{default:t(()=>[u(a(r(l)("common.close")),1)]),_:1})]),default:t(()=>[c.value?(p(),k("div",Oe,[o($,{column:1,border:"",size:"small"},{default:t(()=>[o(i,{label:r(l)("order.reservationCode")},{default:t(()=>[u(a(c.value.reservationCode),1)]),_:1},8,["label"]),o(i,{label:"PID"},{default:t(()=>[u(a(c.value.pid),1)]),_:1}),o(i,{label:r(l)("order.checkIn")},{default:t(()=>[u(a(c.value.checkin),1)]),_:1},8,["label"]),o(i,{label:r(l)("order.checkOut")},{default:t(()=>[u(a(c.value.checkout),1)]),_:1},8,["label"]),o(i,{label:r(l)("order.platform")},{default:t(()=>[u(a(c.value.platform),1)]),_:1},8,["label"]),o(i,{label:r(l)("order.lengthOfStay")},{default:t(()=>[u(a(c.value.lengthOfStay),1)]),_:1},8,["label"])]),_:1})])):M("",!0)]),_:1},8,["modelValue"])):M("",!0)],64)}}},it=ie(Ve,[["__scopeId","data-v-1f623b7a"]]);export{it as default};
