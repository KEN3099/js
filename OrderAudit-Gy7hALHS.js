import{r as f,q as S,l as J,b as F,c as a,aa as n,o as b,K as Q,u as s,N as h,ad as m,e as X,a9 as Z,ab as ee,F as te}from"./@vue-C4NowhOt.js";import{u as ae}from"./vue-i18n-DLYs8-Ps.js";import{a as x}from"./axios-NIGUFBhG.js";import{d as le}from"./dayjs-CflfeGVC.js";import{_ as ne}from"./index-CeZUq1ge.js";import{C as oe,h as p,F as se,i as de,l as ie,n as re,a as ue,I as ce,D as me,S as pe,B as ve,j as fe,z as he}from"./ant-design-vue-A2bDz-ar.js";import{b as _e,a as ge}from"./@ant-design-BGOLSkC9.js";import"./@intlify-ZcBRI--x.js";import"./pinia-9OtbBE5K.js";import"./vue-router-PaDTG1U4.js";import"./element-plus-Mh0yyZIL.js";import"./lodash-es-wgX17T5E.js";import"./@vueuse-BBvwCcyR.js";import"./@element-plus-DaL4F972.js";import"./@popperjs-DB1lLFnh.js";import"./@ctrl-DOFZgDuz.js";import"./async-validator-CRx4dHSJ.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DnZj_KkR.js";import"./@babel-Bq4_u9L9.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-99Xd1yP8.js";import"./dom-align-CRCehRfe.js";import"./throttle-debounce-CUWDS_la.js";const ye={style:{"margin-left":"16px"}},we={key:1},ke={__name:"OrderAudit",setup(Ie){const{t:e}=ae(),_=f([]),w=f(!1);f(!1);const u=f([]),B=S(()=>({selectedRowKeys:u.value,onChange:l=>{u.value=l},preserveSelectedRowKeys:!0})),o=f({startDate:null,endDate:null,status:void 0,hostId:void 0,pid:void 0}),O=f([]),D=f(!1),z=S(()=>[{label:e("common.all"),value:null},...O.value]),v=f({current:1,pageSize:10,total:0}),R=S(()=>[{title:"No.",dataIndex:"no",key:"no",width:60},{title:"ID",dataIndex:"id",key:"id",width:80},{title:"PID",dataIndex:"pid",key:"pid",width:80},{title:e("fields.host"),dataIndex:"hostName",key:"hostName",width:80},{title:e("order.platform"),dataIndex:"platform",key:"platform",width:100},{title:e("order.reservationCode"),dataIndex:"reservationCode",key:"reservationCode",width:120},{title:e("order.checkIn"),dataIndex:"checkin",key:"checkin",width:100},{title:e("order.checkOut"),dataIndex:"checkout",key:"checkout",width:100},{title:e("order.lengthOfStay"),dataIndex:"lengthOfStay",key:"lengthOfStay",width:80},{title:e("order.guestName"),dataIndex:"guestName",key:"guestName",width:120},{title:e("order.netIncome"),dataIndex:"netIncome",key:"netIncome",width:100},{title:e("order.cleanFee"),dataIndex:"cleanFee",key:"cleanFee",width:100},{title:"ADR",dataIndex:"adr",key:"adr",width:80},{title:e("order.currency"),dataIndex:"currency",key:"currency",width:80},{title:e("fields.gentime"),dataIndex:"gentime",key:"gentime",width:80},{title:e("fields.status"),dataIndex:"action",key:"action",width:80}]),U=async()=>{try{D.value=!0;const l=await x.get("/admin/host/getAllHostName");l.data.code==200?O.value=l.data.data.map(t=>({label:t.hostName,value:t.id})):p.error(l.data.message||e("common.getHostListFailed"))}catch(l){console.error("获取房东列表失败:",l),p.error(e("common.getHostListFailed")+": "+l.message)}finally{D.value=!1}},q=l=>({1:"Airbnb",2:"Booking.com"})[l]||l,P=l=>l?le(l).format("YYYY-MM-DD"):"",j=(l,t)=>t.label.toLowerCase().indexOf(l.toLowerCase())>=0,y=async(l=1,t=10)=>{w.value=!0;try{const r={page:l,size:t,startDate:o.value.startDate,endDate:o.value.endDate,hostId:o.value.hostId,pid:o.value.pid};o.value.status!==void 0&&o.value.status!==null&&(r.status=o.value.status);const d=await x.get("/admin/setting/auditOrderList",{params:r});d.data.code===200?(v.value.current=l,v.value.pageSize=t,v.value.total=d.data.data.total,_.value=d.data.data.records.map((c,I)=>({...c,key:(l-1)*t+I,no:(l-1)*t+I+1})),u.value=[]):p.error(d.data.message||e("common.queryFailed"))}catch(r){p.error(e("common.queryFailed")+": "+r.message)}finally{w.value=!1}},H=l=>{y(l.current,l.pageSize)},N=()=>{v.value.current=1,y(1,v.value.pageSize)},K=()=>{o.value.startDate=null,o.value.endDate=null,o.value.status=void 0,o.value.hostId=void 0,o.value.pid=void 0,v.value.current=1,y(1,v.value.pageSize)},T=async(l,t)=>{t.auditLoading=!0;try{const r=l?2:1,d=new FormData;d.append("id",t.id),d.append("status",r);const c=await x.post("/admin/setting/auditOrder",d);c.data.code===200?(p.success(e("success.operationSuccess")),t.status=r.toString()):(p.error(c.data.message||e("common.queryFailed")),t.status=t.status==="2"?"1":"2")}catch(r){t.status=t.status==="2"?"1":"2",p.error(e("common.queryFailed")+": "+r.message)}finally{t.auditLoading=!1}await y()},V=()=>{u.value.length===_.value.length&&_.value.length>0?u.value=[]:u.value=_.value.map(l=>l.id)},A=async l=>{if(u.value.length===0){p.warning(e("common.pleaseSelectItems"));return}try{w.value=!0;const t=l?2:1,r=new URLSearchParams;r.append("ids",u.value.join(",")),r.append("status",t);const d=await x.post("/admin/setting/auditOrders",r,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});d.data.code===200?(p.success(e("success.operationSuccess")),u.value=[],await y(v.value.current,v.value.pageSize)):p.error(d.data.message||e("common.operationFailed"))}catch(t){p.error(e("common.operationFailed")+": "+t.message)}finally{w.value=!1}};return J(()=>{U(),y()}),(l,t)=>{const r=ue,d=re,c=ie,I=ce,Y=me,L=pe,k=ve,M=de,$=se,C=oe,E=he,W=fe;return b(),F("div",null,[a(C,{style:{"margin-bottom":"16px"}},{default:n(()=>[a($,{model:o.value,"label-col":{span:6},"wrapper-col":{span:18},onSubmit:Q(N,["prevent"])},{default:n(()=>[a(M,{gutter:16},{default:n(()=>[a(c,{span:4},{default:n(()=>[a(d,{label:s(e)("fields.host"),class:"mb-2"},{default:n(()=>[a(r,{value:o.value.hostId,"onUpdate:value":t[0]||(t[0]=i=>o.value.hostId=i),"show-search":"",placeholder:s(e)("common.select"),options:z.value,loading:D.value,"filter-option":j,"allow-clear":""},null,8,["value","placeholder","options","loading"])]),_:1},8,["label"])]),_:1}),a(c,{span:3},{default:n(()=>[a(d,{label:"PID",class:"mb-2"},{default:n(()=>[a(I,{value:o.value.pid,"onUpdate:value":t[1]||(t[1]=i=>o.value.pid=i),placeholder:s(e)("common.input")},null,8,["value","placeholder"])]),_:1})]),_:1}),a(c,{span:4},{default:n(()=>[a(d,{label:s(e)("time.startDate"),class:"mb-2"},{default:n(()=>[a(Y,{value:o.value.startDate,"onUpdate:value":t[2]||(t[2]=i=>o.value.startDate=i),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1}),a(c,{span:4},{default:n(()=>[a(d,{label:s(e)("time.endDate"),class:"mb-2"},{default:n(()=>[a(Y,{value:o.value.endDate,"onUpdate:value":t[3]||(t[3]=i=>o.value.endDate=i),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1}),a(c,{span:3},{default:n(()=>[a(d,{label:s(e)("fields.status"),class:"mb-2"},{default:n(()=>[a(r,{value:o.value.status,"onUpdate:value":t[4]||(t[4]=i=>o.value.status=i),placeholder:s(e)("common.select"),"allow-clear":""},{default:n(()=>[a(L,{value:"1"},{default:n(()=>[h(m(s(e)("status.hidden")),1)]),_:1}),a(L,{value:"2"},{default:n(()=>[h(m(s(e)("status.visible")),1)]),_:1})]),_:1},8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),a(c,{span:6},{default:n(()=>[a(d,{"wrapper-col":{span:24},class:"mb-2",style:{"text-align":"right","margin-bottom":"0"}},{default:n(()=>[a(k,{type:"primary",onClick:N},{default:n(()=>[h(m(s(e)("common.search")),1)]),_:1}),a(k,{style:{"margin-left":"8px"},onClick:K},{default:n(()=>[h(m(s(e)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(C,{style:{"margin-bottom":"16px"}},{default:n(()=>[a(M,{gutter:16},{default:n(()=>[a(c,{span:24},{default:n(()=>[a(k,{onClick:V,style:{"margin-right":"8px"}},{default:n(()=>[h(m(u.value.length===_.value.length&&_.value.length>0?s(e)("common.deselectAll"):s(e)("common.selectAll")),1)]),_:1}),a(k,{type:"primary",onClick:t[5]||(t[5]=i=>A(!0)),disabled:u.value.length===0,style:{"margin-right":"8px"}},{default:n(()=>[h(m(s(e)("common.batchApprove")),1)]),_:1},8,["disabled"]),a(k,{onClick:t[6]||(t[6]=i=>A(!1)),disabled:u.value.length===0},{default:n(()=>[h(m(s(e)("common.batchReject")),1)]),_:1},8,["disabled"]),X("span",ye,m(s(e)("common.selected"))+" "+m(u.value.length)+" "+m(s(e)("common.items")),1)]),_:1})]),_:1})]),_:1}),a(C,null,{default:n(()=>[a(W,{columns:R.value,"data-source":_.value,loading:w.value,pagination:v.value,scroll:{x:!0},onChange:H,"row-key":"id",size:"small","row-selection":B.value},{bodyCell:n(({column:i,record:g})=>[i.dataIndex==="checkin"||i.dataIndex==="checkout"?(b(),F(te,{key:0},[h(m(P(g[i.dataIndex])),1)],64)):i.dataIndex==="platform"?(b(),F("span",we,m(q(g.platform)),1)):i.dataIndex==="action"?(b(),Z(E,{key:2,checked:g.auditId!==null&&g.auditId!==void 0&&g.auditId!=="",onChange:G=>T(G,g),loading:g.auditLoading,size:"small"},{checkedChildren:n(()=>[a(s(ge))]),unCheckedChildren:n(()=>[a(s(_e))]),_:2},1032,["checked","onChange","loading"])):ee("",!0)]),_:1},8,["columns","data-source","loading","pagination","row-selection"])]),_:1})])}}},Xe=ne(ke,[["__scopeId","data-v-608ee93a"]]);export{Xe as default};
