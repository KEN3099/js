import{a as E,r as f,q as ne,l as ie,z as re,a9 as k,aa as o,o as v,c as l,e as g,u as n,N as r,ad as i,b as S,ab as T,F as O,a4 as H,K as D}from"./@vue-C4NowhOt.js";import{u as de}from"./vue-i18n-DLYs8-Ps.js";import{a as P}from"./axios-NIGUFBhG.js";import{d as K}from"./dayjs-CflfeGVC.js";import{_ as pe}from"./index-CeZUq1ge.js";import{h as I,d as ce,f as ue,C as me,F as fe,n as _e,D as ve,B as ge,j as be,T as he,o as xe,g as we,q as ye,r as ke}from"./ant-design-vue-A2bDz-ar.js";import"./@intlify-ZcBRI--x.js";import"./pinia-9OtbBE5K.js";import"./vue-router-PaDTG1U4.js";import"./@ant-design-BGOLSkC9.js";import"./@ctrl-DOFZgDuz.js";import"./element-plus-Mh0yyZIL.js";import"./lodash-es-wgX17T5E.js";import"./@vueuse-BBvwCcyR.js";import"./@element-plus-DaL4F972.js";import"./@popperjs-DB1lLFnh.js";import"./async-validator-CRx4dHSJ.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DnZj_KkR.js";import"./@babel-Bq4_u9L9.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-99Xd1yP8.js";import"./dom-align-CRCehRfe.js";import"./throttle-debounce-CUWDS_la.js";const Ie={class:"form-fields"},Ce={class:"form-actions"},Me=["onClick"],Ye=["title"],ze=["src"],Fe={__name:"SettlementReportLite",setup(Se){const{t}=de(),m=E({periodFrom:null,periodTo:null}),$="/api/host/";P.defaults.baseURL=$;const U=f([]),C=f(!1),d=f(!1),p=E({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]}),c=f(!1),G=ne(()=>{const a=[{title:t("fields.period"),dataIndex:"period",width:200},{title:t("fields.incomeAmountThisPeriod"),dataIndex:"income",width:120},{title:t("fields.deductionAmountThisPeriod"),dataIndex:"payment",width:120},{title:t("fields.actualSettlementAmount"),dataIndex:"balance",width:120},{title:t("fields.createdAt"),dataIndex:"gentime",width:180},{title:t("fields.updatedAt"),dataIndex:"uptime",width:180},{title:t("fields.action"),dataIndex:"action",width:100,fixed:d.value?void 0:"right"}];return d.value?a.filter(e=>e.dataIndex==="period"||e.dataIndex==="balance"||e.dataIndex==="action").map(e=>e.dataIndex==="period"?{...e,width:120}:e.dataIndex==="balance"?{...e,width:80}:e.dataIndex==="action"?{...e,width:80}:e):a}),M=f(!1),u=f({}),w=f(!1),b=f(""),L=()=>{b.value&&(window.URL.revokeObjectURL(b.value),b.value=""),w.value=!1,c.value=!1},Q=()=>{c.value=!c.value},Y=()=>{d.value=window.innerWidth<=768},N=a=>({0:t("status.pendingGenerate"),1:t("status.generated"),2:t("status.settled")})[a]||t("status.unknown"),R=a=>({0:"default",1:"processing",2:"success"})[a]||"default",z=a=>a?K(a).format("YYYY-MM-DD HH:mm:ss"):"-",A=a=>a&&a>K().endOf("month"),y=async()=>{try{C.value=!0;const a={page:p.current,size:p.pageSize,...m};a.periodFrom&&(a.periodFrom=a.periodFrom.format("YYYY-MM")),a.periodTo&&(a.periodTo=a.periodTo.format("YYYY-MM"));const e=await P.post("/host/report/settlement/query",a);e.data.code==200?(U.value=e.data.data.records||e.data.data||[],p.total=e.data.data.total||0):I.error(e.data.message||"æŸ¥è¯¢å¤±è´¥")}catch(a){console.error("æŸ¥è¯¢å¤±è´¥:",a),I.error("æŸ¥è¯¢å¤±è´¥: "+a.message)}finally{C.value=!1}},W=()=>{p.current=1,y()},J=()=>{m.periodFrom=null,m.periodTo=null,p.current=1,y()},X=a=>{p.current=a.current,p.pageSize=a.pageSize,y()},Z=async a=>{try{const e={id:a.id},h=await P.get("/host/report/settlement/generate",{params:e});h.data.code==200?(b.value=h.data.data,w.value=!0):I.error(h.data.message||"èŽ·å–PDFå¤±è´¥")}catch(e){console.error("èŽ·å–PDFå¤±è´¥:",e),I.error("èŽ·å–PDFå¤±è´¥: "+(e.response?.data?.message||e.message))}};return ie(()=>{Y(),y(),window.addEventListener("resize",Y)}),re(()=>{window.removeEventListener("resize",Y)}),(a,e)=>{const h=ve,F=_e,B=ge,ee=fe,q=me,V=he,te=xe,ae=be,oe=ue,_=ke,se=ye,j=we,le=ce;return v(),k(le,{class:"billing-report-page"},{default:o(()=>[l(oe,{class:"content"},{default:o(()=>[l(q,{class:"query-card"},{default:o(()=>[l(ee,{model:m,layout:"inline",class:"query-form"},{default:o(()=>[g("div",Ie,[l(F,{label:n(t)("fields.periodFrom"),class:"form-item"},{default:o(()=>[l(h,{value:m.periodFrom,"onUpdate:value":e[0]||(e[0]=s=>m.periodFrom=s),picker:"month",format:"YYYY-MM",placeholder:n(t)("fields.selectPeriodFrom"),class:"responsive-date-picker","disabled-date":A,"get-popup-container":s=>s.parentNode},null,8,["value","placeholder","get-popup-container"])]),_:1},8,["label"]),l(F,{label:n(t)("fields.periodTo"),class:"form-item"},{default:o(()=>[l(h,{value:m.periodTo,"onUpdate:value":e[1]||(e[1]=s=>m.periodTo=s),picker:"month",format:"YYYY-MM",placeholder:n(t)("fields.selectPeriodTo"),class:"responsive-date-picker","disabled-date":A,"get-popup-container":s=>s.parentNode},null,8,["value","placeholder","get-popup-container"])]),_:1},8,["label"])]),g("div",Ce,[l(F,{class:"action-buttons"},{default:o(()=>[l(B,{type:"primary",onClick:W,class:"action-button"},{default:o(()=>[r(i(n(t)("common.search")),1)]),_:1}),l(B,{style:{"margin-left":"8px"},onClick:J,class:"action-button"},{default:o(()=>[r(i(n(t)("common.reset")),1)]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1}),l(q,{class:"table-card",bodyStyle:{padding:0}},{default:o(()=>[l(ae,{dataSource:U.value,columns:G.value,loading:C.value,onChange:X,rowKey:"id",scroll:d.value?{x:1e3}:void 0,size:d.value?"small":"default",pagination:d.value?{...p,simple:!0}:p},{bodyCell:o(({column:s,record:x})=>[s.dataIndex==="status"?(v(),k(V,{key:0,color:R(x.status),class:"status-tag"},{default:o(()=>[r(i(N(x.status)),1)]),_:2},1032,["color"])):s.dataIndex==="gentime"||s.dataIndex==="uptime"?(v(),S(O,{key:1},[r(i(z(x[s.dataIndex])),1)],64)):s.dataIndex==="income"||s.dataIndex==="payment"||s.dataIndex==="balance"?(v(),S(O,{key:2},[r(i(x[s.dataIndex]),1)],64)):s.dataIndex==="action"?(v(),k(te,{key:3,size:d.value?"small":"middle",class:"action-space"},{default:o(()=>[g("a",{onClick:Te=>Z(x),class:"pdf-link",style:{"margin-right":"8px"}},i(n(t)("common.preview"))+"/"+i(n(t)("common.download")),9,Me)]),_:2},1032,["size"])):T("",!0)]),_:1},8,["dataSource","columns","loading","scroll","size","pagination"])]),_:1})]),_:1}),l(j,{visible:M.value,"onUpdate:visible":e[2]||(e[2]=s=>M.value=s),title:n(t)("settlement.settlementDetails"),onCancel:e[3]||(e[3]=s=>M.value=!1),footer:null,width:d.value?"95%":"600px"},{default:o(()=>[u.value?(v(),k(se,{key:0,bordered:"",size:"small",column:1},{default:o(()=>[l(_,{label:n(t)("fields.period")},{default:o(()=>[r(i(u.value.period),1)]),_:1},8,["label"]),l(_,{label:n(t)("fields.income")},{default:o(()=>[r(i(u.value.income),1)]),_:1},8,["label"]),l(_,{label:n(t)("fields.payment")},{default:o(()=>[r(i(u.value.payment),1)]),_:1},8,["label"]),l(_,{label:n(t)("fields.balance")},{default:o(()=>[r(i(u.value.balance),1)]),_:1},8,["label"]),l(_,{label:n(t)("fields.status")},{default:o(()=>[l(V,{color:R(u.value.status),class:"status-tag"},{default:o(()=>[r(i(N(u.value.status)),1)]),_:1},8,["color"])]),_:1},8,["label"]),l(_,{label:n(t)("fields.createdAt")},{default:o(()=>[r(i(z(u.value.gentime)),1)]),_:1},8,["label"]),l(_,{label:n(t)("fields.updatedAt")},{default:o(()=>[r(i(z(u.value.uptime)),1)]),_:1},8,["label"])]),_:1})):T("",!0)]),_:1},8,["visible","title","width"]),l(j,{visible:w.value,"onUpdate:visible":e[5]||(e[5]=s=>w.value=s),title:n(t)("common.preview"),onCancel:L,footer:null,width:d.value?"95%":c.value?"100%":"80%",wrapClassName:c.value?"pdf-preview-modal fullscreen":"pdf-preview-modal",style:H(c.value?{position:"fixed",top:0,left:0,width:"100%",height:"100%",margin:0,padding:0}:{}),closable:!1},{default:o(()=>[g("div",{style:{display:"flex","align-items":"center",position:"absolute",right:"20px",top:"15px","z-index":"1000"},onClick:e[4]||(e[4]=D(()=>{},["stop"]))},[g("button",{onClick:D(Q,["stop"]),style:{"margin-right":"15px",background:"#1890ff",border:"none",cursor:"pointer",color:"white","font-size":"16px",width:"32px",height:"32px","border-radius":"4px",display:"flex","align-items":"center","justify-content":"center","font-weight":"bold",outline:"none"},title:c.value?n(t)("fullscreen.exit"):n(t)("fullscreen.enter")},i(c.value?"ðŸ——":"â›¶"),9,Ye),g("span",{onClick:D(L,["stop"]),style:{cursor:"pointer","font-size":"32px",color:"#000000",display:"flex","align-items":"center","justify-content":"center",width:"32px",height:"32px",outline:"none","box-shadow":"none"}},"Ã—")]),b.value?(v(),S("div",{key:0,class:"pdf-container",style:H(c.value?{height:"calc(100vh - 40px)"}:{height:"70vh"})},[g("iframe",{src:b.value,class:"pdf-iframe"},null,8,ze)],4)):T("",!0)]),_:1},8,["visible","title","width","wrapClassName","style"])]),_:1})}}},it=pe(Fe,[["__scopeId","data-v-d406e078"]]);export{it as default};
