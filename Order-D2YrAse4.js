import{u as ee}from"./vue-i18n-DLYs8-Ps.js";import{a as T}from"./axios-NIGUFBhG.js";import{d as D}from"./dayjs-CflfeGVC.js";import{r as te}from"./index-CeZUq1ge.js";import{B as ae,a as oe,j as ne,S as re,D as le,I as se}from"./ant-design-vue-A2bDz-ar.js";import{S as j}from"./@ant-design-BGOLSkC9.js";import{r as _,a as ce,q as L,l as ie,b as x,c as l,e as w,aa as r,ab as R,u as s,F as U,ag as $,o as d,N as f,ad as u,a9 as M}from"./@vue-C4NowhOt.js";import"./@intlify-ZcBRI--x.js";import"./pinia-9OtbBE5K.js";import"./vue-router-PaDTG1U4.js";import"./element-plus-Mh0yyZIL.js";import"./lodash-es-wgX17T5E.js";import"./@vueuse-BBvwCcyR.js";import"./@element-plus-DaL4F972.js";import"./@popperjs-DB1lLFnh.js";import"./@ctrl-DOFZgDuz.js";import"./async-validator-CRx4dHSJ.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DnZj_KkR.js";import"./@babel-Bq4_u9L9.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-99Xd1yP8.js";import"./dom-align-CRCehRfe.js";import"./throttle-debounce-CUWDS_la.js";const de={style:{"margin-bottom":"16px","margin-top":"16px"}},ue={style:{display:"flex","align-items":"center","margin-bottom":"10px"}},pe={key:0,style:{display:"flex","flex-wrap":"wrap",gap:"10px","margin-bottom":"10px"}},me={style:{"margin-right":"5px"}},he={key:0},ve={style:{padding:"8px"}},Ge={__name:"Order",setup(fe){const{t:n}=ee(),N=_([]),O=_(!1),h=_([]),c=ce({}),g=_({}),q="/api/host/";T.defaults.baseURL=q;const i=_({current:1,pageSize:10,total:0,pages:0}),p=_({column:"checkin",asc:!1}),y=L(()=>[{title:"No.",dataIndex:"no",key:"no"},{title:"PID",dataIndex:"pid",key:"pid"},{title:n("order.platform"),dataIndex:"platform",key:"platform"},{title:n("order.reservationCode"),dataIndex:"reservationCode",key:"reservationCode"},{title:n("order.checkIn"),dataIndex:"checkin",key:"checkin",sorter:!0,defaultSortOrder:"descend"},{title:n("order.checkOut"),dataIndex:"checkout",key:"checkout",sorter:!0},{title:n("order.lengthOfStay"),dataIndex:"lengthOfStay",key:"lengthOfStay"},{title:n("order.guestName"),dataIndex:"guestName",key:"guestName"},{title:n("order.netIncome"),dataIndex:"netIncome",key:"netIncome"},{title:n("order.cleanFee"),dataIndex:"cleanFee",key:"cleanFee"},{title:n("order.currency"),dataIndex:"currency",key:"currency"}]),V=L(()=>y.value.filter(e=>e.key!=="no")),B=e=>{const t=V.value.find(a=>a.key===e);return t?t.dataIndex==="checkin"?"入住月份":t.dataIndex==="checkout"?"退房月份":t.title:""},I=e=>{const t=y.value.find(a=>a.key===e);return t?t.dataIndex:null},A=e=>{const t=D(),a=t.subtract(3,"month"),v=t.add(3,"month");return e<a.startOf("month")||e>v.endOf("month")},k=async(e=1,t=10)=>{O.value=!0;try{const a={page:e,size:t,...g.value,column:p.value.column,asc:p.value.asc},v=await T.get("/host/order/query2list",{params:a});i.value.current=e,i.value.pageSize=t,i.value.total=v.data.data.total,i.value.pages=v.data.data.pages,N.value=v.data.data.records.map((Y,C)=>({...Y,key:(e-1)*t+C,no:(e-1)*t+C+1}))}catch(a){console.error("获取订单数据失败:",a)}finally{O.value=!1}},G=(e,t,a)=>{a.field&&(p.value.column=a.field,p.value.asc=a.order==="ascend"),k(e.current,e.pageSize)},z=(e,t,a)=>{t(),g.value[a]=e[0],k(1,i.value.pageSize)},H=(e,t)=>{e(),delete g.value[t],k(1,i.value.pageSize)},J=e=>{h.value=e},F=(e,t)=>{(I(e)==="checkin"||I(e)==="checkout")&&t?c[e]=D(t).format("YYYY-MM-01"):c[e]=t},Q=()=>{g.value={},h.value.forEach(e=>{const t=y.value.find(a=>a.key===e);t&&c[e]&&(g.value[t.dataIndex]=c[e])}),p.value.column="checkin",p.value.asc=!1,k(1,i.value.pageSize)},W=()=>{te.push("/orderGantt")},X=()=>{h.value=[],Object.keys(c).forEach(e=>{delete c[e]}),g.value={},p.value.column="checkin",p.value.asc=!1,k(1,i.value.pageSize)};return ie(()=>{k()}),(e,t)=>{const a=ae,v=re,Y=oe,C=le,P=se,Z=ne;return d(),x("div",null,[l(a,{type:"primary",disabled:"true"},{default:r(()=>[f(u(s(n)("common.listView")),1)]),_:1}),l(a,{type:"primary",onClick:W,style:{"margin-left":"10px"}},{default:r(()=>[f(u(s(n)("common.calendarView")),1)]),_:1}),w("div",de,[w("div",ue,[l(Y,{value:h.value,"onUpdate:value":t[0]||(t[0]=o=>h.value=o),placeholder:s(n)("common.select"),mode:"multiple",style:{width:"300px","margin-right":"10px"},onChange:J},{default:r(()=>[(d(!0),x(U,null,$(V.value,o=>(d(),M(v,{key:o.key,value:o.key},{default:r(()=>[f(u(o.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"]),l(a,{type:"primary",onClick:Q},{icon:r(()=>[l(s(j))]),default:r(()=>[f(" "+u(s(n)("common.search")),1)]),_:1}),l(a,{style:{"margin-left":"10px"},onClick:X},{default:r(()=>[f(u(s(n)("common.reset")),1)]),_:1})]),h.value.length>0?(d(),x("div",pe,[(d(!0),x(U,null,$(h.value,o=>(d(),x("div",{key:o},[w("span",me,u(B(o))+": ",1),I(o)==="checkin"||I(o)==="checkout"?(d(),M(C,{key:0,value:c[o]?s(D)(c[o]):null,format:"YYYY-MM","value-format":"YYYY-MM-DD","disabled-date":A,picker:"month",style:{width:"150px"},onChange:(m,S)=>F(o,S)},null,8,["value","onChange"])):(d(),M(P,{key:1,placeholder:`输入${B(o)}`,value:c[o],style:{width:"150px"},onChange:m=>F(o,m.target.value)},null,8,["placeholder","value","onChange"]))]))),128))])):R("",!0)]),l(Z,{columns:y.value,"data-source":N.value,loading:O.value,scroll:{x:!0},pagination:i.value,onChange:G},{bodyCell:r(({column:o,record:m})=>[o.dataIndex==="platform"?(d(),x("span",he,u(m.platform),1)):R("",!0)]),customFilterDropdown:r(({setSelectedKeys:o,selectedKeys:m,confirm:S,clearFilters:K,column:b})=>[w("div",ve,[l(P,{ref:"searchInput",placeholder:`${s(n)("common.search")} ${b.title}`,value:m[0],style:{width:"188px","margin-bottom":"8px",display:"block"},onChange:E=>o(E.target.value?[E.target.value]:[]),onPressEnter:()=>z(m,S,b.dataIndex)},null,8,["placeholder","value","onChange","onPressEnter"]),l(a,{type:"primary",size:"small",style:{width:"90px","margin-right":"8px"},onClick:()=>z(m,S,b.dataIndex)},{icon:r(()=>[l(s(j))]),default:r(()=>[f(" "+u(s(n)("common.search")),1)]),_:2},1032,["onClick"]),l(a,{size:"small",style:{width:"90px"},onClick:()=>H(K,b.dataIndex)},{default:r(()=>[f(u(s(n)("common.reset")),1)]),_:2},1032,["onClick"])])]),_:1},8,["columns","data-source","loading","pagination"])])}}};export{Ge as default};
